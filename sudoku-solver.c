#include <assert.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>

typedef uint8_t u8;
typedef uint16_t u16;
typedef uint32_t u32;
typedef uint64_t u64;
typedef int8_t i8;
typedef int16_t i16;
typedef int32_t i32;
typedef int64_t i64;

#define positive_mask(offset, nbits) (((1 << (nbits)) - 1) << offset)
#define negative_mask(offset, nbits) (~positive_mask(offset, nbits))
#define clear_bits(expr, offset, nbits) ((expr) & negative_mask(offset, nbits))
#define filter_bits(expr, offset, nbits) ((expr) & positive_mask(offset, nbits))
#define getbits(expr, offset, nbits) ((expr) >> (offset) & ((1 << (nbits)) - 1))
#define setbits(expr, offset, nbits, value)                                    \
    (clear_bits(expr, offset, nbits) | filter_bits(value, 0, nbits) << offset)

#define normal_node_count (9 * 9 * 9 * 4)
#define header_node_count (9 * 9 * 4)
#define total_node_count (normal_node_count + header_node_count)

// Compile with -DPRECOMPUTE_DATA to regenerate these arrays
// Compile with -DIGNORE_PRECOMPUTED to generate these on the fly
u32 headers[header_node_count + 1] = {
    37751108, 37752832, 37754881, 37756930, 37758979, 37761028, 37763077,
    37765126, 37767175, 37769224, 37771273, 37773322, 37775371, 37777420,
    37779469, 37781518, 37783567, 37785616, 37787665, 37789714, 37791763,
    37793812, 37795861, 37797910, 37799959, 37802008, 37804057, 37806106,
    37808155, 37810204, 37812253, 37814302, 37816351, 37818400, 37820449,
    37822498, 37824547, 37826596, 37828645, 37830694, 37832743, 37834792,
    37836841, 37838890, 37840939, 37842988, 37845037, 37847086, 37849135,
    37851184, 37853233, 37855282, 37857331, 37859380, 37861429, 37863478,
    37865527, 37867576, 37869625, 37871674, 37873723, 37875772, 37877821,
    37879870, 37881919, 37883968, 37886017, 37888066, 37890115, 37892164,
    37894213, 37896262, 37898311, 37900360, 37902409, 37904458, 37906507,
    37908556, 37910605, 37912654, 37914703, 37916752, 37918801, 37920850,
    37922899, 37924948, 37926997, 37929046, 37931095, 37933144, 37935193,
    37937242, 37939291, 37941340, 37943389, 37945438, 37947487, 37949536,
    37951585, 37953634, 37955683, 37957732, 37959781, 37961830, 37963879,
    37965928, 37967977, 37970026, 37972075, 37974124, 37976173, 37978222,
    37980271, 37982320, 37984369, 37986418, 37988467, 37990516, 37992565,
    37994614, 37996663, 37998712, 38000761, 38002810, 38004859, 38006908,
    38008957, 38011006, 38013055, 38015104, 38017153, 38019202, 38021251,
    38023300, 38025349, 38027398, 38029447, 38031496, 38033545, 38035594,
    38037643, 38039692, 38041741, 38043790, 38045839, 38047888, 38049937,
    38051986, 38054035, 38056084, 38058133, 38060182, 38062231, 38064280,
    38066329, 38068378, 38070427, 38072476, 38074525, 38076574, 38078623,
    38080672, 38082721, 38084770, 38086819, 38088868, 38090917, 38092966,
    38095015, 38097064, 38099113, 38101162, 38103211, 38105260, 38107309,
    38109358, 38111407, 38113456, 38115505, 38117554, 38119603, 38121652,
    38123701, 38125750, 38127799, 38129848, 38131897, 38133946, 38135995,
    38138044, 38140093, 38142142, 38144191, 38146240, 38148289, 38150338,
    38152387, 38154436, 38156485, 38158534, 38160583, 38162632, 38164681,
    38166730, 38168779, 38170828, 38172877, 38174926, 38176975, 38179024,
    38181073, 38183122, 38185171, 38187220, 38189269, 38191318, 38193367,
    38195416, 38197465, 38199514, 38201563, 38203612, 38205661, 38207710,
    38209759, 38211808, 38213857, 38215906, 38217955, 38220004, 38222053,
    38224102, 38226151, 38228200, 38230249, 38232298, 38234347, 38236396,
    38238445, 38240494, 38242543, 38244592, 38246641, 38248690, 38250739,
    38252788, 38254837, 38256886, 38258935, 38260984, 38263033, 38265082,
    38267131, 38269180, 38271229, 38273278, 38275327, 38277376, 38279425,
    38281474, 38283523, 38285572, 38287621, 38289670, 38291719, 38293768,
    38295817, 38297866, 38299915, 38301964, 38304013, 38306062, 38308111,
    38310160, 38312209, 38314258, 38316307, 38318356, 38320405, 38322454,
    38324503, 38326552, 38328601, 38330650, 38332699, 38334748, 38336797,
    38338846, 38340895, 38342944, 38344993, 38347042, 38349091, 38351140,
    38353189, 38355238, 38357287, 38359336, 38361385, 38363434, 38365483,
    38367532, 38369581, 38371630, 38373679, 38375728, 38377777, 38379826,
    38381875, 38383924, 38385973, 38388022, 38390071, 38392120, 38394169,
    38396218, 38398267, 38400316, 38402365, 38404414, 38406463, 38408512,
    38410561, 38412610, 323,
};
u32 nodes[total_node_count] = {
    21243456,  21505664,  21767872,  22030080,  22292288,  22554496,  22816704,
    23078912,  23341120,  42482304,  42744512,  43006720,  43268928,  43531136,
    43793344,  44055552,  44317760,  44579968,  63721152,  63983360,  64245568,
    64507776,  64769984,  65032192,  65294400,  65556608,  65818816,  84960000,
    85222208,  85484416,  85746624,  86008832,  86271040,  86533248,  86795456,
    87057664,  106198848, 106461056, 106723264, 106985472, 107247680, 107509888,
    107772096, 108034304, 108296512, 127437696, 127699904, 127962112, 128224320,
    128486528, 128748736, 129010944, 129273152, 129535360, 148676544, 148938752,
    149200960, 149463168, 149725376, 149987584, 150249792, 150512000, 150774208,
    169915392, 170177600, 170439808, 170702016, 170964224, 171226432, 171488640,
    171750848, 172013056, 191154240, 191416448, 191678656, 191940864, 192203072,
    192465280, 192727488, 192989696, 193251904, 21345872,  21608080,  21870288,
    22132496,  22394704,  22656912,  22919120,  23181328,  23443536,  23705744,
    23967952,  24230160,  24492368,  24754576,  25016784,  25278992,  25541200,
    25803408,  26065616,  26327824,  26590032,  26852240,  27114448,  27376656,
    27638864,  27901072,  28163280,  28425488,  28687696,  28949904,  29212112,
    29474320,  29736528,  29998736,  30260944,  30523152,  30785360,  31047568,
    31309776,  31571984,  31834192,  32096400,  32358608,  32620816,  32883024,
    33145232,  33407440,  33669648,  33931856,  34194064,  34456272,  34718480,
    34980688,  35242896,  35505104,  35767312,  36029520,  36291728,  36553936,
    36816144,  37078352,  37340560,  37602768,  37864976,  38127184,  38389392,
    38651600,  38913808,  39176016,  39438224,  39700432,  39962640,  40224848,
    40487056,  40749264,  41011472,  41273680,  41535888,  41798096,  42060304,
    42322512,  21381472,  21643680,  21905888,  22168096,  22430304,  22692512,
    22954720,  23216928,  23479136,  28461088,  28723296,  28985504,  29247712,
    29509920,  29772128,  30034336,  30296544,  30558752,  35540704,  35802912,
    36065120,  36327328,  36589536,  36851744,  37113952,  37376160,  37638368,
    85098016,  85360224,  85622432,  85884640,  86146848,  86409056,  86671264,
    86933472,  87195680,  92177632,  92439840,  92702048,  92964256,  93226464,
    93488672,  93750880,  94013088,  94275296,  99257248,  99519456,  99781664,
    100043872, 100306080, 100568288, 100830496, 101092704, 101354912, 148814560,
    149076768, 149338976, 149601184, 149863392, 150125600, 150387808, 150650016,
    150912224, 155894176, 156156384, 156418592, 156680800, 156943008, 157205216,
    157467424, 157729632, 157991840, 162973792, 163236000, 163498208, 163760416,
    164022624, 164284832, 164547040, 164809248, 165071456, 21436016,  23795888,
    26155760,  28515632,  30875504,  33235376,  35595248,  37955120,  40314992,
    42674864,  45034736,  47394608,  49754480,  52114352,  54474224,  56834096,
    59193968,  61553840,  63913712,  66273584,  68633456,  70993328,  73353200,
    75713072,  78072944,  80432816,  82792688,  85152560,  87512432,  89872304,
    92232176,  94592048,  96951920,  99311792,  101671664, 104031536, 106391408,
    108751280, 111111152, 113471024, 115830896, 118190768, 120550640, 122910512,
    125270384, 127630256, 129990128, 132350000, 134709872, 137069744, 139429616,
    141789488, 144149360, 146509232, 148869104, 151228976, 153588848, 155948720,
    158308592, 160668464, 163028336, 165388208, 167748080, 170107952, 172467824,
    174827696, 177187568, 179547440, 181907312, 184267184, 186627056, 188986928,
    191346800, 193706672, 196066544, 198426416, 200786288, 203146160, 205506032,
    207865904, 210225776, 23592973,  42534162,  23726631,  21696312,  23855133,
    42796322,  23988791,  21959800,  24117293,  43058482,  24250951,  22222008,
    24379453,  43320642,  24513111,  22484216,  24641613,  43582802,  24775271,
    22746424,  24903773,  43844962,  25037431,  23008632,  25165933,  44107122,
    25299591,  23270840,  25428093,  44369282,  25561751,  23533048,  25690253,
    44631442,  25823911,  15930936,  25957453,  44893602,  26088551,  24055624,
    26219661,  45155762,  26350759,  24319672,  26481869,  45417922,  26612967,
    24581880,  26744077,  45680082,  26875175,  24844088,  27006285,  45942242,
    27137383,  25106296,  27268493,  46204402,  27399591,  25368504,  27530701,
    46466562,  27661799,  25630712,  27792909,  46728722,  27924007,  25892920,
    28055117,  46990882,  28186215,  15997048,  28317325,  47253042,  42604199,
    26414936,  28579533,  47515202,  42866407,  26679544,  28841741,  47777362,
    43128615,  26941752,  29103949,  48039522,  43390823,  27203960,  29366157,
    48301682,  43653031,  27466168,  29628365,  48563842,  43915239,  27728376,
    29890573,  48826002,  44177447,  27990584,  30152781,  49088162,  44439655,
    28252792,  30414989,  49350322,  44701863,  16063160,  30677197,  49612482,
    30804663,  28774248,  30939405,  49874642,  31066823,  29039416,  31201613,
    50136802,  31328983,  29301624,  31463821,  50398962,  31591143,  29563832,
    31726029,  50661122,  31853303,  29826040,  31988237,  50923282,  32115463,
    30088248,  32250445,  51185442,  32377623,  30350456,  32512653,  51447602,
    32639783,  30612664,  32774861,  51709762,  32901943,  16129272,  33037069,
    51971922,  33168167,  31133560,  33299277,  52234082,  33430375,  31399288,
    33561485,  52496242,  33692583,  31661496,  33823693,  52758402,  33954791,
    31923704,  34085901,  53020562,  34216999,  32185912,  34348109,  53282722,
    34479207,  32448120,  34610317,  53544882,  34741415,  32710328,  34872525,
    53807042,  35003623,  32972536,  35134733,  54069202,  35265831,  16195384,
    35396941,  54331362,  49683815,  33492872,  35659149,  54593522,  49946023,
    33759160,  35921357,  54855682,  50208231,  34021368,  36183565,  55117842,
    50470439,  34283576,  36445773,  55380002,  50732647,  34545784,  36707981,
    55642162,  50994855,  34807992,  36970189,  55904322,  51257063,  35070200,
    37232397,  56166482,  51519271,  35332408,  37494605,  56428642,  51781479,
    16261496,  37756813,  56690802,  37882695,  35852184,  38019021,  56952962,
    38144855,  36119032,  38281229,  57215122,  38407015,  36381240,  38543437,
    57477282,  38669175,  36643448,  38805645,  57739442,  38931335,  36905656,
    39067853,  58001602,  39193495,  37167864,  39330061,  58263762,  39455655,
    37430072,  39592269,  58525922,  39717815,  37692280,  39854477,  58788082,
    39979975,  16327608,  40116685,  59050242,  40247783,  38211496,  40378893,
    59312402,  40509991,  38478904,  40641101,  59574562,  40772199,  38741112,
    40903309,  59836722,  41034407,  39003320,  41165517,  60098882,  41296615,
    39265528,  41427725,  60361042,  41558823,  39527736,  41689933,  60623202,
    41821031,  39789944,  41952141,  60885362,  42083239,  40052152,  42214349,
    61147522,  42345447,  16393720,  9229,      61409682,  56763431,  40570808,
    74829,     61671842,  57025639,  40838776,  140429,    61934002,  57287847,
    41100984,  206029,    62196162,  57550055,  41363192,  271629,    62458322,
    57812263,  41625400,  337229,    62720482,  58074471,  41887608,  402829,
    62982642,  58336679,  42149816,  468429,    63244802,  58598887,  42412024,
    534029,    63506962,  58861095,  16459832,  44826781,  63771730,  44964071,
    42930120,  45088941,  64033938,  45226279,  43198648,  45351101,  64296146,
    45488487,  43460856,  45613261,  64558354,  45750695,  43723064,  45875421,
    64820562,  46012903,  43985272,  46137581,  65082770,  46275111,  44247480,
    46399741,  65344978,  46537319,  44509688,  46661901,  65607186,  46799527,
    44771896,  46924061,  65869394,  47061735,  16525944,  47196301,  66131602,
    47327399,  45289432,  47458509,  66393810,  47589607,  45558520,  47720717,
    66656018,  47851815,  45820728,  47982925,  66918226,  48114023,  46082936,
    48245133,  67180434,  48376231,  46345144,  48507341,  67442642,  48638439,
    46607352,  48769549,  67704850,  48900647,  46869560,  49031757,  67967058,
    49162855,  47131768,  49293965,  68229266,  49425063,  16592056,  49556173,
    68491474,  63843047,  47648744,  49818381,  68753682,  64105255,  47918392,
    50080589,  69015890,  64367463,  48180600,  50342797,  69278098,  64629671,
    48442808,  50605005,  69540306,  64891879,  48705016,  50867213,  69802514,
    65154087,  48967224,  51129421,  70064722,  65416295,  49229432,  51391629,
    70326930,  65678503,  49491640,  51653837,  70589138,  65940711,  16658168,
    51916045,  70851346,  52043687,  50008056,  52178253,  71113554,  52305895,
    50278264,  52440461,  71375762,  52568103,  50540472,  52702669,  71637970,
    52830311,  50802680,  52964877,  71900178,  53092519,  51064888,  53227085,
    72162386,  53354727,  51327096,  53489293,  72424594,  53616935,  51589304,
    53751501,  72686802,  53879143,  51851512,  54013709,  72949010,  54141351,
    16724280,  54275917,  73211218,  54407015,  52367368,  54538125,  73473426,
    54669223,  52638136,  54800333,  73735634,  54931431,  52900344,  55062541,
    73997842,  55193639,  53162552,  55324749,  74260050,  55455847,  53424760,
    55586957,  74522258,  55718055,  53686968,  55849165,  74784466,  55980263,
    53949176,  56111373,  75046674,  56242471,  54211384,  56373581,  75308882,
    56504679,  16790392,  56635789,  75571090,  70922663,  54726680,  56897997,
    75833298,  71184871,  54998008,  57160205,  76095506,  71447079,  55260216,
    57422413,  76357714,  71709287,  55522424,  57684621,  76619922,  71971495,
    55784632,  57946829,  76882130,  72233703,  56046840,  58209037,  77144338,
    72495911,  56309048,  58471245,  77406546,  72758119,  56571256,  58733453,
    77668754,  73020327,  16856504,  58995661,  77930962,  59123303,  57085992,
    59257869,  78193170,  59385511,  57357880,  59520077,  78455378,  59647719,
    57620088,  59782285,  78717586,  59909927,  57882296,  60044493,  78979794,
    60172135,  58144504,  60306701,  79242002,  60434343,  58406712,  60568909,
    79504210,  60696551,  58668920,  60831117,  79766418,  60958759,  58931128,
    61093325,  80028626,  61220967,  16922616,  61355533,  80290834,  61486631,
    59445304,  61617741,  80553042,  61748839,  59717752,  61879949,  80815250,
    62011047,  59979960,  62142157,  81077458,  62273255,  60242168,  62404365,
    81339666,  62535463,  60504376,  62666573,  81601874,  62797671,  60766584,
    62928781,  81864082,  63059879,  61028792,  63190989,  82126290,  63322087,
    61291000,  63453197,  82388498,  63584295,  16988728,  604237,    82650706,
    78002279,  61804616,  669837,    82912914,  78264487,  62077624,  735437,
    83175122,  78526695,  62339832,  801037,    83437330,  78788903,  62602040,
    866637,    83699538,  79051111,  62864248,  932237,    83961746,  79313319,
    63126456,  997837,    84223954,  79575527,  63388664,  1063437,   84486162,
    79837735,  63650872,  1129037,   84748370,  80099943,  17054840,  66060589,
    85010578,  66202919,  64163928,  66322749,  85272786,  66465127,  64437496,
    66584909,  85534994,  66727335,  64699704,  66847069,  85797202,  66989543,
    64961912,  67109229,  86059410,  67251751,  65224120,  67371389,  86321618,
    67513959,  65486328,  67633549,  86583826,  67776167,  65748536,  67895709,
    86846034,  68038375,  66010744,  68157869,  87108242,  68300583,  17120952,
    68435149,  87370450,  68566247,  66523240,  68697357,  87632658,  68828455,
    66797368,  68959565,  87894866,  69090663,  67059576,  69221773,  88157074,
    69352871,  67321784,  69483981,  88419282,  69615079,  67583992,  69746189,
    88681490,  69877287,  67846200,  70008397,  88943698,  70139495,  68108408,
    70270605,  89205906,  70401703,  68370616,  70532813,  89468114,  70663911,
    17187064,  70795021,  89730322,  10632999,  68882552,  71057229,  89992530,
    10698599,  69157240,  71319437,  90254738,  10764199,  69419448,  71581645,
    90516946,  10829799,  69681656,  71843853,  90779154,  10895399,  69943864,
    72106061,  91041362,  10960999,  70206072,  72368269,  91303570,  11026599,
    70468280,  72630477,  91565778,  11092199,  70730488,  72892685,  91827986,
    11157799,  17253176,  73154893,  92090194,  73282535,  71241864,  73417101,
    92352402,  73544743,  71517112,  73679309,  92614610,  73806951,  71779320,
    73941517,  92876818,  74069159,  72041528,  74203725,  93139026,  74331367,
    72303736,  74465933,  93401234,  74593575,  72565944,  74728141,  93663442,
    74855783,  72828152,  74990349,  93925650,  75117991,  73090360,  75252557,
    94187858,  75380199,  17319288,  75514765,  94450066,  75645863,  73601176,
    75776973,  94712274,  75908071,  73876984,  76039181,  94974482,  76170279,
    74139192,  76301389,  95236690,  76432487,  74401400,  76563597,  95498898,
    76694695,  74663608,  76825805,  95761106,  76956903,  74925816,  77088013,
    96023314,  77219111,  75188024,  77350221,  96285522,  77481319,  75450232,
    77612429,  96547730,  77743527,  17385400,  77874637,  96809938,  11224551,
    75960488,  78136845,  97072146,  11290151,  76236856,  78399053,  97334354,
    11355751,  76499064,  78661261,  97596562,  11421351,  76761272,  78923469,
    97858770,  11486951,  77023480,  79185677,  98120978,  11552551,  77285688,
    79447885,  98383186,  11618151,  77547896,  79710093,  98645394,  11683751,
    77810104,  79972301,  98907602,  11749351,  17451512,  80234509,  99169810,
    80362151,  78319800,  80496717,  99432018,  80624359,  78596728,  80758925,
    99694226,  80886567,  78858936,  81021133,  99956434,  81148775,  79121144,
    81283341,  100218642, 81410983,  79383352,  81545549,  100480850, 81673191,
    79645560,  81807757,  100743058, 81935399,  79907768,  82069965,  101005266,
    82197607,  80169976,  82332173,  101267474, 82459815,  17517624,  82594381,
    101529682, 82725479,  80679112,  82856589,  101791890, 82987687,  80956600,
    83118797,  102054098, 83249895,  81218808,  83381005,  102316306, 83512103,
    81481016,  83643213,  102578514, 83774311,  81743224,  83905421,  102840722,
    84036519,  82005432,  84167629,  103102930, 84298727,  82267640,  84429837,
    103365138, 84560935,  82529848,  84692045,  103627346, 84823143,  17583736,
    1199245,   103889554, 11816103,  83038424,  1264845,   104151762, 11881703,
    83316472,  1330445,   104413970, 11947303,  83578680,  1396045,   104676178,
    12012903,  83840888,  1461645,   104938386, 12078503,  84103096,  1527245,
    105200594, 12144103,  84365304,  1592845,   105462802, 12209703,  84627512,
    1658445,   105725010, 12275303,  84889720,  1724045,   105987218, 12340903,
    17649848,  87294397,  106249426, 87428055,  85397736,  87556557,  106511634,
    87690215,  85676344,  87818717,  106773842, 87952375,  85938552,  88080877,
    107036050, 88214535,  86200760,  88343037,  107298258, 88476695,  86462968,
    88605197,  107560466, 88738855,  86725176,  88867357,  107822674, 89001015,
    86987384,  89129517,  108084882, 89263175,  87249592,  89391677,  108347090,
    89525335,  17715960,  89673997,  108609298, 89805095,  87757048,  89936205,
    108871506, 90067303,  88036216,  90198413,  109133714, 90329511,  88298424,
    90460621,  109395922, 90591719,  88560632,  90722829,  109658130, 90853927,
    88822840,  90985037,  109920338, 91116135,  89085048,  91247245,  110182546,
    91378343,  89347256,  91509453,  110444754, 91640551,  89609464,  91771661,
    110706962, 91902759,  17782072,  92033869,  110969170, 106320743, 90116360,
    92296077,  111231378, 106582951, 90396088,  92558285,  111493586, 106845159,
    90658296,  92820493,  111755794, 107107367, 90920504,  93082701,  112018002,
    107369575, 91182712,  93344909,  112280210, 107631783, 91444920,  93607117,
    112542418, 107893991, 91707128,  93869325,  112804626, 108156199, 91969336,
    94131533,  113066834, 108418407, 17848184,  94393741,  113329042, 94506087,
    92475672,  94655949,  113591250, 94768247,  92755960,  94918157,  113853458,
    95030407,  93018168,  95180365,  114115666, 95292567,  93280376,  95442573,
    114377874, 95554727,  93542584,  95704781,  114640082, 95816887,  93804792,
    95966989,  114902290, 96079047,  94067000,  96229197,  115164498, 96341207,
    94329208,  96491405,  115426706, 96603367,  17914296,  96753613,  115688914,
    96884711,  94834984,  97015821,  115951122, 97146919,  95115832,  97278029,
    116213330, 97409127,  95378040,  97540237,  116475538, 97671335,  95640248,
    97802445,  116737746, 97933543,  95902456,  98064653,  116999954, 98195751,
    96164664,  98326861,  117262162, 98457959,  96426872,  98589069,  117524370,
    98720167,  96689080,  98851277,  117786578, 98982375,  17980408,  99113485,
    118048786, 113400359, 97194296,  99375693,  118310994, 113662567, 97475704,
    99637901,  118573202, 113924775, 97737912,  99900109,  118835410, 114186983,
    98000120,  100162317, 119097618, 114449191, 98262328,  100424525, 119359826,
    114711399, 98524536,  100686733, 119622034, 114973607, 98786744,  100948941,
    119884242, 115235815, 99048952,  101211149, 120146450, 115498023, 18046520,
    101473357, 120408658, 101584119, 99553608,  101735565, 120670866, 101846279,
    99835576,  101997773, 120933074, 102108439, 100097784, 102259981, 121195282,
    102370599, 100359992, 102522189, 121457490, 102632759, 100622200, 102784397,
    121719698, 102894919, 100884408, 103046605, 121981906, 103157079, 101146616,
    103308813, 122244114, 103419239, 101408824, 103571021, 122506322, 103681399,
    18112632,  103833229, 122768530, 103964327, 101912920, 104095437, 123030738,
    104226535, 102195448, 104357645, 123292946, 104488743, 102457656, 104619853,
    123555154, 104750951, 102719864, 104882061, 123817362, 105013159, 102982072,
    105144269, 124079570, 105275367, 103244280, 105406477, 124341778, 105537575,
    103506488, 105668685, 124603986, 105799783, 103768696, 105930893, 124866194,
    106061991, 18178744,  1794253,   125128402, 120479975, 104272232, 1859853,
    125390610, 120742183, 104555320, 1925453,   125652818, 121004391, 104817528,
    1991053,   125915026, 121266599, 105079736, 2056653,   126177234, 121528807,
    105341944, 2122253,   126439442, 121791015, 105604152, 2187853,   126701650,
    122053223, 105866360, 2253453,   126963858, 122315431, 106128568, 2319053,
    127226066, 122577639, 18244856,  108528205, 127488274, 108680615, 106631544,
    108790365, 127750482, 108942823, 106915192, 109052525, 128012690, 109205031,
    107177400, 109314685, 128274898, 109467239, 107439608, 109576845, 128537106,
    109729447, 107701816, 109839005, 128799314, 109991655, 107964024, 110101165,
    129061522, 110253863, 108226232, 110363325, 129323730, 110516071, 108488440,
    110625485, 129585938, 110778279, 18310968,  110912845, 129848146, 111043943,
    108990856, 111175053, 130110354, 111306151, 109275064, 111437261, 130372562,
    111568359, 109537272, 111699469, 130634770, 111830567, 109799480, 111961677,
    130896978, 112092775, 110061688, 112223885, 131159186, 112354983, 110323896,
    112486093, 131421394, 112617191, 110586104, 112748301, 131683602, 112879399,
    110848312, 113010509, 131945810, 113141607, 18377080,  113272717, 132208018,
    127559591, 111350168, 113534925, 132470226, 127821799, 111634936, 113797133,
    132732434, 128084007, 111897144, 114059341, 132994642, 128346215, 112159352,
    114321549, 133256850, 128608423, 112421560, 114583757, 133519058, 128870631,
    112683768, 114845965, 133781266, 129132839, 112945976, 115108173, 134043474,
    129395047, 113208184, 115370381, 134305682, 129657255, 18443192,  115632589,
    134567890, 115760231, 113709480, 115894797, 134830098, 116022439, 113994808,
    116157005, 135092306, 116284647, 114257016, 116419213, 135354514, 116546855,
    114519224, 116681421, 135616722, 116809063, 114781432, 116943629, 135878930,
    117071271, 115043640, 117205837, 136141138, 117333479, 115305848, 117468045,
    136403346, 117595687, 115568056, 117730253, 136665554, 117857895, 18509304,
    117992461, 136927762, 118123559, 116068792, 118254669, 137189970, 118385767,
    116354680, 118516877, 137452178, 118647975, 116616888, 118779085, 137714386,
    118910183, 116879096, 119041293, 137976594, 119172391, 117141304, 119303501,
    138238802, 119434599, 117403512, 119565709, 138501010, 119696807, 117665720,
    119827917, 138763218, 119959015, 117927928, 120090125, 139025426, 120221223,
    18575416,  120352333, 139287634, 134639207, 118428104, 120614541, 139549842,
    134901415, 118714552, 120876749, 139812050, 135163623, 118976760, 121138957,
    140074258, 135425831, 119238968, 121401165, 140336466, 135688039, 119501176,
    121663373, 140598674, 135950247, 119763384, 121925581, 140860882, 136212455,
    120025592, 122187789, 141123090, 136474663, 120287800, 122449997, 141385298,
    136736871, 18641528,  122712205, 141647506, 122839847, 120787416, 122974413,
    141909714, 123102055, 121074424, 123236621, 142171922, 123364263, 121336632,
    123498829, 142434130, 123626471, 121598840, 123761037, 142696338, 123888679,
    121861048, 124023245, 142958546, 124150887, 122123256, 124285453, 143220754,
    124413095, 122385464, 124547661, 143482962, 124675303, 122647672, 124809869,
    143745170, 124937511, 18707640,  125072077, 144007378, 125203175, 123146728,
    125334285, 144269586, 125465383, 123434296, 125596493, 144531794, 125727591,
    123696504, 125858701, 144794002, 125989799, 123958712, 126120909, 145056210,
    126252007, 124220920, 126383117, 145318418, 126514215, 124483128, 126645325,
    145580626, 126776423, 124745336, 126907533, 145842834, 127038631, 125007544,
    127169741, 146105042, 127300839, 18773752,  2389261,   146367250, 141718823,
    125506040, 2454861,   146629458, 141981031, 125794168, 2520461,   146891666,
    142243239, 126056376, 2586061,   147153874, 142505447, 126318584, 2651661,
    147416082, 142767655, 126580792, 2717261,   147678290, 143029863, 126843000,
    2782861,   147940498, 143292071, 127105208, 2848461,   148202706, 143554279,
    127367416, 2914061,   148464914, 143816487, 18839864,  129762013, 148727122,
    129919463, 127865352, 130024173, 148989330, 130181671, 128154040, 130286333,
    149251538, 130443879, 128416248, 130548493, 149513746, 130706087, 128678456,
    130810653, 149775954, 130968295, 128940664, 131072813, 150038162, 131230503,
    129202872, 131334973, 150300370, 131492711, 129465080, 131597133, 150562578,
    131754919, 129727288, 131859293, 150824786, 132017127, 18905976,  132151693,
    151086994, 132282791, 130224664, 132413901, 151349202, 132544999, 130513912,
    132676109, 151611410, 132807207, 130776120, 132938317, 151873618, 133069415,
    131038328, 133200525, 152135826, 133331623, 131300536, 133462733, 152398034,
    133593831, 131562744, 133724941, 152660242, 133856039, 131824952, 133987149,
    152922450, 134118247, 132087160, 134249357, 153184658, 134380455, 18972088,
    134511565, 153446866, 12418023,  132583976, 134773773, 153709074, 12483623,
    132873784, 135035981, 153971282, 12549223,  133135992, 135298189, 154233490,
    12614823,  133398200, 135560397, 154495698, 12680423,  133660408, 135822605,
    154757906, 12746023,  133922616, 136084813, 155020114, 12811623,  134184824,
    136347021, 155282322, 12877223,  134447032, 136609229, 155544530, 12942823,
    19038200,  136871437, 155806738, 136999079, 134943288, 137133645, 156068946,
    137261287, 135233656, 137395853, 156331154, 137523495, 135495864, 137658061,
    156593362, 137785703, 135758072, 137920269, 156855570, 138047911, 136020280,
    138182477, 157117778, 138310119, 136282488, 138444685, 157379986, 138572327,
    136544696, 138706893, 157642194, 138834535, 136806904, 138969101, 157904402,
    139096743, 19104312,  139231309, 158166610, 139362407, 137302600, 139493517,
    158428818, 139624615, 137593528, 139755725, 158691026, 139886823, 137855736,
    140017933, 158953234, 140149031, 138117944, 140280141, 159215442, 140411239,
    138380152, 140542349, 159477650, 140673447, 138642360, 140804557, 159739858,
    140935655, 138904568, 141066765, 160002066, 141197863, 139166776, 141328973,
    160264274, 141460071, 19170424,  141591181, 160526482, 13009575,  139661912,
    141853389, 160788690, 13075175,  139953400, 142115597, 161050898, 13140775,
    140215608, 142377805, 161313106, 13206375,  140477816, 142640013, 161575314,
    13271975,  140740024, 142902221, 161837522, 13337575,  141002232, 143164429,
    162099730, 13403175,  141264440, 143426637, 162361938, 13468775,  141526648,
    143688845, 162624146, 13534375,  19236536,  143951053, 162886354, 144078695,
    142021224, 144213261, 163148562, 144340903, 142313272, 144475469, 163410770,
    144603111, 142575480, 144737677, 163672978, 144865319, 142837688, 144999885,
    163935186, 145127527, 143099896, 145262093, 164197394, 145389735, 143362104,
    145524301, 164459602, 145651943, 143624312, 145786509, 164721810, 145914151,
    143886520, 146048717, 164984018, 146176359, 19302648,  146310925, 165246226,
    146442023, 144380536, 146573133, 165508434, 146704231, 144673144, 146835341,
    165770642, 146966439, 144935352, 147097549, 166032850, 147228647, 145197560,
    147359757, 166295058, 147490855, 145459768, 147621965, 166557266, 147753063,
    145721976, 147884173, 166819474, 148015271, 145984184, 148146381, 167081682,
    148277479, 146246392, 148408589, 167343890, 148539687, 19368760,  2984269,
    167606098, 13601127,  146739848, 3049869,   167868306, 13666727,  147033016,
    3115469,   168130514, 13732327,  147295224, 3181069,   168392722, 13797927,
    147557432, 3246669,   168654930, 13863527,  147819640, 3312269,   168917138,
    13929127,  148081848, 3377869,   169179346, 13994727,  148344056, 3443469,
    169441554, 14060327,  148606264, 3509069,   169703762, 14125927,  19434872,
    150995821, 169965970, 151129479, 149099160, 151257981, 170228178, 151391639,
    149392888, 151520141, 170490386, 151653799, 149655096, 151782301, 170752594,
    151915959, 149917304, 152044461, 171014802, 152178119, 150179512, 152306621,
    171277010, 152440279, 150441720, 152568781, 171539218, 152702439, 150703928,
    152830941, 171801426, 152964599, 150966136, 153093101, 172063634, 153226759,
    19500984,  153390541, 172325842, 153521639, 151458472, 153652749, 172588050,
    153783847, 151752760, 153914957, 172850258, 154046055, 152014968, 154177165,
    173112466, 154308263, 152277176, 154439373, 173374674, 154570471, 152539384,
    154701581, 173636882, 154832679, 152801592, 154963789, 173899090, 155094887,
    153063800, 155225997, 174161298, 155357095, 153326008, 155488205, 174423506,
    155619303, 19567096,  155750413, 174685714, 170037287, 153817784, 156012621,
    174947922, 170299495, 154112632, 156274829, 175210130, 170561703, 154374840,
    156537037, 175472338, 170823911, 154637048, 156799245, 175734546, 171086119,
    154899256, 157061453, 175996754, 171348327, 155161464, 157323661, 176258962,
    171610535, 155423672, 157585869, 176521170, 171872743, 155685880, 157848077,
    176783378, 172134951, 19633208,  158110285, 177045586, 158207511, 156177096,
    158372493, 177307794, 158469671, 156472504, 158634701, 177570002, 158731831,
    156734712, 158896909, 177832210, 158993991, 156996920, 159159117, 178094418,
    159256151, 157259128, 159421325, 178356626, 159518311, 157521336, 159683533,
    178618834, 159780471, 157783544, 159945741, 178881042, 160042631, 158045752,
    160207949, 179143250, 160304791, 19699320,  160470157, 179405458, 160601255,
    158536408, 160732365, 179667666, 160863463, 158832376, 160994573, 179929874,
    161125671, 159094584, 161256781, 180192082, 161387879, 159356792, 161518989,
    180454290, 161650087, 159619000, 161781197, 180716498, 161912295, 159881208,
    162043405, 180978706, 162174503, 160143416, 162305613, 181240914, 162436711,
    160405624, 162567821, 181503122, 162698919, 19765432,  162830029, 181765330,
    177116903, 160895720, 163092237, 182027538, 177379111, 161192248, 163354445,
    182289746, 177641319, 161454456, 163616653, 182551954, 177903527, 161716664,
    163878861, 182814162, 178165735, 161978872, 164141069, 183076370, 178427943,
    162241080, 164403277, 183338578, 178690151, 162503288, 164665485, 183600786,
    178952359, 162765496, 164927693, 183862994, 179214567, 19831544,  165189901,
    184125202, 165285543, 163255032, 165452109, 184387410, 165547703, 163552120,
    165714317, 184649618, 165809863, 163814328, 165976525, 184911826, 166072023,
    164076536, 166238733, 185174034, 166334183, 164338744, 166500941, 185436242,
    166596343, 164600952, 166763149, 185698450, 166858503, 164863160, 167025357,
    185960658, 167120663, 165125368, 167287565, 186222866, 167382823, 19897656,
    167549773, 186485074, 167680871, 165614344, 167811981, 186747282, 167943079,
    165911992, 168074189, 187009490, 168205287, 166174200, 168336397, 187271698,
    168467495, 166436408, 168598605, 187533906, 168729703, 166698616, 168860813,
    187796114, 168991911, 166960824, 169123021, 188058322, 169254119, 167223032,
    169385229, 188320530, 169516327, 167485240, 169647437, 188582738, 169778535,
    19963768,  3579277,   188844946, 184196519, 167973656, 3644877,   189107154,
    184458727, 168271864, 3710477,   189369362, 184720935, 168534072, 3776077,
    189631570, 184983143, 168796280, 3841677,   189893778, 185245351, 169058488,
    3907277,   190155986, 185507559, 169320696, 3972877,   190418194, 185769767,
    169582904, 4038477,   190680402, 186031975, 169845112, 4104077,   190942610,
    186294183, 20029880,  172229629, 191204818, 172397159, 170332968, 172491789,
    191467026, 172659367, 170631736, 172753949, 191729234, 172921575, 170893944,
    173016109, 191991442, 173183783, 171156152, 173278269, 192253650, 173445991,
    171418360, 173540429, 192515858, 173708199, 171680568, 173802589, 192778066,
    173970407, 171942776, 174064749, 193040274, 174232615, 172204984, 174326909,
    193302482, 174494823, 20095992,  174629389, 193564690, 174760487, 172692280,
    174891597, 193826898, 175022695, 172991608, 175153805, 194089106, 175284903,
    173253816, 175416013, 194351314, 175547111, 173516024, 175678221, 194613522,
    175809319, 173778232, 175940429, 194875730, 176071527, 174040440, 176202637,
    195137938, 176333735, 174302648, 176464845, 195400146, 176595943, 174564856,
    176727053, 195662354, 176858151, 20162104,  176989261, 195924562, 191276135,
    175051592, 177251469, 196186770, 191538343, 175351480, 177513677, 196448978,
    191800551, 175613688, 177775885, 196711186, 192062759, 175875896, 178038093,
    196973394, 192324967, 176138104, 178300301, 197235602, 192587175, 176400312,
    178562509, 197497810, 192849383, 176662520, 178824717, 197760018, 193111591,
    176924728, 179086925, 198022226, 193373799, 20228216,  179349133, 198284434,
    179476775, 177410904, 179611341, 198546642, 179738983, 177711352, 179873549,
    198808850, 180001191, 177973560, 180135757, 199071058, 180263399, 178235768,
    180397965, 199333266, 180525607, 178497976, 180660173, 199595474, 180787815,
    178760184, 180922381, 199857682, 181050023, 179022392, 181184589, 200119890,
    181312231, 179284600, 181446797, 200382098, 181574439, 20294328,  181709005,
    200644306, 181840103, 179770216, 181971213, 200906514, 182102311, 180071224,
    182233421, 201168722, 182364519, 180333432, 182495629, 201430930, 182626727,
    180595640, 182757837, 201693138, 182888935, 180857848, 183020045, 201955346,
    183151143, 181120056, 183282253, 202217554, 183413351, 181382264, 183544461,
    202479762, 183675559, 181644472, 183806669, 202741970, 183937767, 20360440,
    184068877, 203004178, 198355751, 182129528, 184331085, 203266386, 198617959,
    182431096, 184593293, 203528594, 198880167, 182693304, 184855501, 203790802,
    199142375, 182955512, 185117709, 204053010, 199404583, 183217720, 185379917,
    204315218, 199666791, 183479928, 185642125, 204577426, 199928999, 183742136,
    185904333, 204839634, 200191207, 184004344, 186166541, 205101842, 200453415,
    20426552,  186428749, 205364050, 186556391, 184488840, 186690957, 205626258,
    186818599, 184790968, 186953165, 205888466, 187080807, 185053176, 187215373,
    206150674, 187343015, 185315384, 187477581, 206412882, 187605223, 185577592,
    187739789, 206675090, 187867431, 185839800, 188001997, 206937298, 188129639,
    186102008, 188264205, 207199506, 188391847, 186364216, 188526413, 207461714,
    188654055, 20492664,  188788621, 207723922, 188919719, 186848152, 189050829,
    207986130, 189181927, 187150840, 189313037, 208248338, 189444135, 187413048,
    189575245, 208510546, 189706343, 187675256, 189837453, 208772754, 189968551,
    187937464, 190099661, 209034962, 190230759, 188199672, 190361869, 209297170,
    190492967, 188461880, 190624077, 209559378, 190755175, 188724088, 190886285,
    209821586, 191017383, 20558776,  4174285,   210083794, 205435367, 189207464,
    4239885,   210346002, 205697575, 189510712, 4305485,   210608210, 205959783,
    189772920, 4371085,   210870418, 206221991, 190035128, 4436685,   211132626,
    206484199, 190297336, 4502285,   211394834, 206746407, 190559544, 4567885,
    211657042, 207008615, 190821752, 4633485,   211919250, 207270823, 191083960,
    4699085,   212181458, 207533031, 20624888,  193463437, 5349906,   193636007,
    191566776, 193725597, 5415506,   193898215, 191870584, 193987757, 5481106,
    194160423, 192132792, 194249917, 5546706,   194422631, 192395000, 194512077,
    5612306,   194684839, 192657208, 194774237, 5677906,   194947047, 192919416,
    195036397, 5743506,   195209255, 193181624, 195298557, 5809106,   195471463,
    193443832, 195560717, 5874706,   195733671, 20691000,  195868237, 5940306,
    195999335, 193926088, 196130445, 6005906,   196261543, 194230456, 196392653,
    6071506,   196523751, 194492664, 196654861, 6137106,   196785959, 194754872,
    196917069, 6202706,   197048167, 195017080, 197179277, 6268306,   197310375,
    195279288, 197441485, 6333906,   197572583, 195541496, 197703693, 6399506,
    197834791, 195803704, 197965901, 6465106,   198096999, 20757112,  198228109,
    6530706,   14203047,  196285400, 198490317, 6596306,   14268647,  196590328,
    198752525, 6661906,   14334247,  196852536, 199014733, 6727506,   14399847,
    197114744, 199276941, 6793106,   14465447,  197376952, 199539149, 6858706,
    14531047,  197639160, 199801357, 6924306,   14596647,  197901368, 200063565,
    6989906,   14662247,  198163576, 200325773, 7055506,   14727847,  20823224,
    200587981, 7121106,   200715623, 198644712, 200850189, 7186706,   200977831,
    198950200, 201112397, 7252306,   201240039, 199212408, 201374605, 7317906,
    201502247, 199474616, 201636813, 7383506,   201764455, 199736824, 201899021,
    7449106,   202026663, 199999032, 202161229, 7514706,   202288871, 200261240,
    202423437, 7580306,   202551079, 200523448, 202685645, 7645906,   202813287,
    20889336,  202947853, 7711506,   203078951, 201004024, 203210061, 7777106,
    203341159, 201310072, 203472269, 7842706,   203603367, 201572280, 203734477,
    7908306,   203865575, 201834488, 203996685, 7973906,   204127783, 202096696,
    204258893, 8039506,   204389991, 202358904, 204521101, 8105106,   204652199,
    202621112, 204783309, 8170706,   204914407, 202883320, 205045517, 8236306,
    205176615, 20955448,  205307725, 8301906,   14794599,  203363336, 205569933,
    8367506,   14860199,  203669944, 205832141, 8433106,   14925799,  203932152,
    206094349, 8498706,   14991399,  204194360, 206356557, 8564306,   15056999,
    204456568, 206618765, 8629906,   15122599,  204718776, 206880973, 8695506,
    15188199,  204980984, 207143181, 8761106,   15253799,  205243192, 207405389,
    8826706,   15319399,  21021560,  207667597, 8892306,   207795239, 205722648,
    207929805, 8957906,   208057447, 206029816, 208192013, 9023506,   208319655,
    206292024, 208454221, 9089106,   208581863, 206554232, 208716429, 9154706,
    208844071, 206816440, 208978637, 9220306,   209106279, 207078648, 209240845,
    9285906,   209368487, 207340856, 209503053, 9351506,   209630695, 207603064,
    209765261, 9417106,   209892903, 21087672,  210027469, 9482706,   210158567,
    208081960, 210289677, 9548306,   210420775, 208389688, 210551885, 9613906,
    210682983, 208651896, 210814093, 9679506,   210945191, 208914104, 211076301,
    9745106,   211207399, 209176312, 211338509, 9810706,   211469607, 209438520,
    211600717, 9876306,   211731815, 209700728, 211862925, 9941906,   211994023,
    209962936, 212125133, 10007506,  212256231, 21153784,  4769293,   10073106,
    15386151,  210441272, 4834893,   10138706,  15451751,  210749560, 4900493,
    10204306,  15517351,  211011768, 4966093,   10269906,  15582951,  211273976,
    5031693,   10335506,  15648551,  211536184, 5097293,   10401106,  15714151,
    211798392, 5162893,   10466706,  15779751,  212060600, 5228493,   10532306,
    15845351,  212322808, 5294093,   10597906,  15910951,  21219896,
};

bool is_header(u16 node) { return node < header_node_count; }

// Left/right of normal nodes
u16 left_of(u16 node) { return (node & ~0b11) + getbits(nodes[node], 2, 2); }
u16 right_of(u16 node) { return (node & ~0b11) + getbits(nodes[node], 0, 2); }
void set_right(u16 node, u16 right) {
    assert(!is_header(node));
    assert((node & ~0b11) == (right & ~0b11)); // nodes should be in same column
    nodes[node] = setbits(nodes[node], 0, 2, right);
    assert(right_of(node) == right);
}
void set_left(u16 node, u16 left) {
    assert(!is_header(node));
    assert((node & ~0b11) == (left & ~0b11)); // nodes should be in same column
    nodes[node] = setbits(nodes[node], 2, 2, left);
    assert(left_of(node) == left);
}

// Left/right of header nodes
u16 header_left(u16 i) { return getbits(headers[i], 0, 11); }
u16 header_right(u16 i) { return getbits(headers[i], 11, 11); }
void header_set_left(u16 i, u16 left) {
    assert(i <= header_node_count);
    headers[i] = setbits(headers[i], 0, 11, left);
    assert(header_left(i) == left);
}
void header_set_right(u16 i, u16 right) {
    assert(i <= header_node_count);
    headers[i] = setbits(headers[i], 11, 11, right);
    assert(header_right(i) == right);
}

u16 above(u16 node) { return getbits(nodes[node], 4, 12); }
u16 below(u16 node) { return getbits(nodes[node], 16, 12); }

u8 constraint_category_of(u16 node) {
    return (node < header_node_count) ? node / 81 : node % 4;
}

void set_above(u16 node, u16 up) {
    assert(constraint_category_of(node) == constraint_category_of(up));
    nodes[node] = setbits(nodes[node], 4, 12, up);
    assert(above(node) == up);
}

void set_below(u16 node, u16 down) {
    assert(constraint_category_of(node) == constraint_category_of(down));
    nodes[node] = setbits(nodes[node], 16, 12, down);
    assert(below(node) == down);
}

void test_nodes() {
    for (u16 i = 400; i < 420; i += 4) {
        for (int j = i; j < i + 4; j++) {
            set_above(j, j);
            set_below(j, j);
            for (int k = i; k < i + 4; k++) {
                u16 left = left_of(j);
                u16 right = right_of(j);
                u16 up = above(j);
                u16 down = below(j);

                set_left(j, k);
                assert(left_of(j) == k);
                set_left(j, left);

                set_right(j, k);
                assert(right_of(j) == k);
                set_right(j, right);

                set_above(j, j + 4);
                assert(above(j) == j + 4);
                set_above(j, up);

                set_below(j, j + 4);
                assert(below(j) == j + 4);
                set_below(j, down);

                assert(left == left_of(j));
                assert(right == right_of(j));
                assert(up == above(j));
                assert(down == below(j));
            }
        }
    }
}

void linkneighbors(int left, int right) {
    set_right(left, right);
    set_left(right, left);
}

/**
 * inserts new above old
 */
void insert_above(u16 old, u16 new) {
    set_above(new, above(old));
    set_below(new, old);
    set_above(old, new);
    set_below(above(new), new);
}

#define iterate_up(n, i) for (int i = above(n); i != n; i = above(i))
#define iterate_down(n, i) for (int i = below(n); i != n; i = below(i))
#define iterate_right(n, i) for (int i = right_of(n); i != n; i = right_of(i))
#define iterate_left(n, i) for (int i = left_of(n); i != n; i = left_of(i))
#define header_iterate_right(n, i)                                             \
    for (int i = header_right(n); i != n; i = header_right(i))
#define header_iterate_left(n, i)                                              \
    for (int i = header_left(n); i != n; i = header_left(i))

u8 header_get_height(u16 node) { return getbits(headers[node], 22, 4); }
void header_set_height(u16 node, u8 height) {
    assert(is_header(node) && "Node must be header");
    headers[node] = setbits(headers[node], 22, 4, height);
    assert(header_get_height(node) == height);
}
void header_dec_height(u16 node) {
    assert(is_header(node) && "Node must be header");
    assert(header_get_height(node) > 0);
    headers[node] -= 1 << 22;
}
void header_inc_height(u16 node) {
    assert(is_header(node) && "Node must be header");
    assert(header_get_height(node) < 9);
    headers[node] += 1 << 22;
}

u8 compute_column_height(u16 node) {
    u8 size = 0;
    iterate_up(node, i) size++;
    return size;
}

u8 column_height(u16 node) {
    u8 height = getbits(headers[node], 22, 4);
    assert(height == compute_column_height(node));
    return height;
}

u16 find_colof_up(u16 node) {
    if (is_header(node))
        return node;
    iterate_up(node, i) {
        if (is_header(i))
            return i;
    };
    assert(false);
}

u16 find_colof_down(u16 node) {
    if (is_header(node))
        return node;
    iterate_down(node, i) {
        if (is_header(i))
            return i;
    };
    assert(false);
}

int colof(int node) {
    if (is_header(node))
        return node;
    int i = (node - header_node_count) / 4;
    int pos = i / 9;
    int value = i % 9;
    int row = pos / 9;
    int col = pos % 9;
    int box = col / 3 + 3 * (row / 3);
    int header;
    switch (node % 4) {
    case 0:
        header = row * 9 + value + 81 * 0;
        break;
    case 1:
        header = col * 9 + value + 81 * 1;
        break;
    case 2:
        header = box * 9 + value + 81 * 2;
        break;
    case 3:
        header = pos + 81 * 3;
        break;
    default:
        assert(false);
    }
    assert(header == find_colof_up(node) && header == find_colof_down(node));
    return header;
}

void remove_node(u16 node) {
    assert(above(below(node)) == node);
    assert(above(below(node)) == node);
    set_above(below(node), above(node));
    set_below(above(node), below(node));

    header_dec_height(colof(node));
}

void reinsert_node(u16 node) {
    assert(above(below(node)) == above(node));
    assert(below(above(node)) == below(node));
    set_above(below(node), node);
    set_below(above(node), node);

    header_inc_height(colof(node));
}

void remove_header(u16 node) {
    assert(header_right(header_left(node)) == node);
    assert(header_left(header_right(node)) == node);
    header_set_right(header_left(node), header_right(node));
    header_set_left(header_right(node), header_left(node));
}

void reinsert_header(u16 node) {
    assert(header_right(header_left(node)) == header_right(node));
    assert(header_left(header_right(node)) == header_left(node));
    header_set_right(header_left(node), node);
    header_set_left(header_right(node), node);
}

void remove_row(u16 node) {
    iterate_right(node, n) { remove_node(n); }
}

void reinsert_row(u16 node) {
    iterate_left(node, n) { reinsert_node(n); }
}

void remove_col(u16 node) {
    assert(!is_header(node));
    iterate_up(node, n) {
        if (is_header(n)) {
            remove_header(n);
        } else {
            remove_row(n);
        }
    }
}

void reinsert_col(u16 node) {
    assert(!is_header(node));
    iterate_down(node, n) {
        if (is_header(n)) {
            reinsert_header(n);
        } else {
            reinsert_row(n);
        }
    }
}

void chooserow(u16 node) {
    assert(!is_header(node));
    iterate_right(node, n) { remove_col(n); }
    remove_col(node);
}

void unchooserow(u16 node) {
    assert(!is_header(node));
    reinsert_col(node);
    iterate_left(node, n) { reinsert_col(n); }
}

void place(u16 pos, u16 value) {
    chooserow(header_node_count + (pos * 9 + value) * 4);
}

void unplace(u16 pos, u16 value) {
    unchooserow(header_node_count + (pos * 9 + value) * 4);
}

u16 smallest_col() {
    u16 smallest = header_right(header_node_count);
    u8 size = column_height(smallest);
    header_iterate_right(header_node_count, node) {
        u8 s = column_height(node);
        if (s < size) {
            smallest = node;
            size = s;
        }
    }
    return smallest;
}

bool algorithmX(char *buffer) {
    if (header_right(header_node_count) == header_node_count) {
        return true;
    }
    u16 smallest = smallest_col();
    iterate_down(smallest, node) {
        chooserow(node);
        bool solved = algorithmX(buffer);
        unchooserow(node);
        if (solved) {
            int i = (node - header_node_count) / 4;
            int pos = i / 9;
            int value = i % 9;
            buffer[pos] = value + '1';
            return true;
        }
    }
    return false;
}

void initialize() {
    // Start by zero initializing everything
    memset(nodes, 0, sizeof(nodes));
    memset(headers, 0, sizeof(headers));

    // Vertically connect headers to themselves
    for (int i = 0; i < header_node_count; i++) {
        set_above(i, i);
        set_below(i, i);
        header_set_left(i + 1, i);
        header_set_right(i, i + 1);
    }
    header_set_left(0, header_node_count);
    header_set_right(header_node_count, 0);
    for (int i = 0; i < header_node_count; i++) {
        header_set_height(i, 9);
    }

    // Setup each row
    for (int i = header_node_count; i < total_node_count; i += 4) {
        linkneighbors(i + 0, i + 1);
        linkneighbors(i + 1, i + 2);
        linkneighbors(i + 2, i + 3);
        linkneighbors(i + 3, i + 0);
        int j = (i - header_node_count) / 4;
        int pos = j / 9;
        int value = j % 9;
        int row = pos / 9;
        int col = pos % 9;
        int box = col / 3 + 3 * (row / 3);

        insert_above(row * 9 + value + 81 * 0, i + 0);
        insert_above(col * 9 + value + 81 * 1, i + 1);
        insert_above(box * 9 + value + 81 * 2, i + 2);
        insert_above(pos /*-------*/ + 81 * 3, i + 3);
    }
}

void make_precomputed_nodes_and_headers() {
    printf("u32 headers[header_node_count + 1] = {");
    for (int i = 0; i < header_node_count + 1; i++) {
        if (i % 8 == 0) {
            printf("\n    ");
        }
        printf("%d, ", headers[i]);
    }
    printf("\n};\n");
    printf("u32 nodes[total_node_count] = {");
    for (int i = 0; i < total_node_count; i++) {
        if (i % 8 == 0) {
            printf("\n    ");
        }
        printf("%d, ", nodes[i]);
    }
    printf("\n};\n");
}

#ifdef PRECOMPUTE_DATA
int main(void) {
    initialize();
    make_precomputed_nodes_and_headers();
}
#else
int main(void) {
#ifdef IGNORE_PRECOMPUTED
    initialize();
#endif

    char buffer[84]; // leave room for \n\r\0
    fgets(buffer, sizeof(buffer), stdin);

    fgets(buffer, sizeof(buffer), stdin);
    for (int i = 0; i < 81; i++) {
        u8 c = buffer[i];
        if (c != '0') {
            place(i, c - '1');
        }
    }

    algorithmX(buffer);
    for (int i = 0; i < 81; i++) {
        putc(buffer[i], stdout);
    }
    putc(10, stdout);
}
#endif
